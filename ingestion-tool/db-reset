#!/usr/bin/env python3

import mariadb
import pysam
import sys
import os
import time

password = os.environ['MARIADB_ROOT_PASSWORD']
db = os.environ['MARIADB_DATABASE']

# ARE YOU SURE?
if input("Are you sure you want to remove all the data in the database? (y/n) ") != "y":
    exit(0)

# MAIN WORKFLOW

try:
    conn = mariadb.connect(
        user="root",
        password=password,
        host="mariadb",
        database=db,
        autocommit=True )
except mariadb.Error as e:
   print(f"Error connecting to the database: {e}", file=sys.stderr)
   sys.exit(1)

cur = conn.cursor() 


print("Removing ALL genomes from avalaible_genomes table... please wait..", file=sys.stderr)
try:
    cur.execute("DELETE FROM avalaible_genomes") 
except mariadb.Error as e:
    print(f"Error: {e}", file=sys.stderr)
    sys.exit(1)

print("Removing ALL genotypes from vcf_genotypes table... please wait..", file=sys.stderr)
try:
    cur.execute("DELETE FROM vcf_genotypes") 
except mariadb.Error as e:
    print(f"Error: {e}", file=sys.stderr)
    sys.exit(1)

print("Finished!", file=sys.stderr)